---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const allTechnologies = [...new Set(projects.flatMap(p => p.data.technologies))];
---

<Layout title="Projects | My Portfolio">
	<h1 class="text-3xl font-bold mb-8">Projects</h1>

	<div class="mb-8">
		<h2 class="text-xl font-semibold mb-3 text-gray-700">Filter by Technology:</h2>
		<div class="flex flex-wrap gap-2" id="filters">
			<button
				class="filter-btn px-4 py-2 rounded-full border border-gray-300 text-sm font-medium hover:bg-indigo-50 active active:bg-indigo-100 active:text-indigo-800 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-indigo-500 bg-indigo-100 text-indigo-800"
				data-filter="all"
			>
				All
			</button>
			{allTechnologies.map((tech) => (
				<button
					class="filter-btn px-4 py-2 rounded-full border border-gray-300 text-sm font-medium hover:bg-indigo-50 hover:text-indigo-800 bg-white text-gray-700 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-indigo-500"
					data-filter={tech}
				>
					{tech}
				</button>
			))}
		</div>
	</div>

	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-grid">
		{projects.map((project) => (
			<div
				class="project-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300"
				data-technologies={JSON.stringify(project.data.technologies)}
			>
				{project.data.image && (
					<img src={project.data.image} alt={project.data.title} class="w-full h-48 object-cover" />
				)}
				<div class="p-6">
					<h3 class="text-xl font-bold mb-2 text-gray-900">{project.data.title}</h3>
					<p class="text-gray-600 mb-4">{project.data.description}</p>
					<div class="flex flex-wrap gap-2 mb-4">
						{project.data.technologies.map(tech => (
							<span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs font-semibold">
								{tech}
							</span>
						))}
					</div>
					<div class="text-sm text-gray-500 mb-4">Year: {project.data.year}</div>
					{project.data.link && (
						<a href={project.data.link} target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 font-medium">
							View Project &rarr;
						</a>
					)}
				</div>
			</div>
		))}
	</div>
</Layout>

<script>
	const buttons = document.querySelectorAll('.filter-btn');
	const projects = document.querySelectorAll('.project-card');

	buttons.forEach(btn => {
		btn.addEventListener('click', () => {
			// Update active state
			buttons.forEach(b => {
				b.classList.remove('bg-indigo-100', 'text-indigo-800');
				b.classList.add('bg-white', 'text-gray-700');
			});
			btn.classList.remove('bg-white', 'text-gray-700');
			btn.classList.add('bg-indigo-100', 'text-indigo-800');

			const filter = btn.getAttribute('data-filter') || 'all';

			projects.forEach(project => {
				const technologies = JSON.parse(project.getAttribute('data-technologies') || '[]');
				if (filter === 'all' || technologies.includes(filter)) {
					(project as HTMLElement).style.display = 'block';
				} else {
					(project as HTMLElement).style.display = 'none';
				}
			});
		});
	});
</script>
