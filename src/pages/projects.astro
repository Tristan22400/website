---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import ProjectCard from '../components/ProjectCard.astro';
import FilterButton from '../components/FilterButton.astro';

const projects = await getCollection('projects');
const allTechnologies = [...new Set(projects.flatMap(p => p.data.technologies))];
---

<Layout title="Projects | My Portfolio">
	<h1 class="text-3xl font-bold mb-8">Projects</h1>

	<section class="mb-8" aria-label="Project Filters">
		<h2 class="text-xl font-semibold mb-3 text-gray-700">Filter by Technology:</h2>
		<div class="flex flex-wrap gap-2" id="filters">
			<FilterButton filter="all" label="All" isActive={true} />
			{allTechnologies.map((tech) => (
				<FilterButton filter={tech} label={tech} />
			))}
		</div>
	</section>

	<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-grid" aria-label="Projects List">
		{projects.map((project) => (
			<div class="project-card-wrapper" data-technologies={JSON.stringify(project.data.technologies)}>
				<ProjectCard
					title={project.data.title}
					description={project.data.description}
					image={project.data.image}
					technologies={project.data.technologies}
					year={project.data.year}
					link={project.data.link}
				/>
			</div>
		))}
	</section>
</Layout>

<script>
	const buttons = document.querySelectorAll('.filter-btn');
	const projects = document.querySelectorAll('.project-card-wrapper');

	buttons.forEach(btn => {
		btn.addEventListener('click', () => {
			// Update active state
			buttons.forEach(b => {
				b.classList.remove('bg-indigo-100', 'text-indigo-800');
				b.classList.add('bg-white', 'text-gray-700', 'hover:bg-indigo-50', 'hover:text-indigo-800');
				b.setAttribute('aria-pressed', 'false');
			});
			btn.classList.remove('bg-white', 'text-gray-700', 'hover:bg-indigo-50', 'hover:text-indigo-800');
			btn.classList.add('bg-indigo-100', 'text-indigo-800');
			btn.setAttribute('aria-pressed', 'true');

			const filter = btn.getAttribute('data-filter') || 'all';

			projects.forEach(project => {
				const technologies = JSON.parse(project.getAttribute('data-technologies') || '[]');
				if (filter === 'all' || technologies.includes(filter)) {
					(project as HTMLElement).style.display = 'block';
				} else {
					(project as HTMLElement).style.display = 'none';
				}
			});
		});
	});
</script>
