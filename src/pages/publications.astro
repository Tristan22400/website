---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const publications = await getCollection('publications');
// Sort by year descending
publications.sort((a, b) => b.data.year - a.data.year);

const allTypes = [...new Set(publications.map(p => p.data.type))];
---

<Layout title="Publications | My Portfolio">
	<h1 class="text-3xl font-bold mb-8">Publications</h1>

	<div class="mb-8">
		<h2 class="text-xl font-semibold mb-3 text-gray-700">Filter by Type:</h2>
		<div class="flex flex-wrap gap-2" id="filters">
			<button
				class="filter-btn px-4 py-2 rounded-full border border-gray-300 text-sm font-medium hover:bg-indigo-50 active active:bg-indigo-100 active:text-indigo-800 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-indigo-500 bg-indigo-100 text-indigo-800"
				data-filter="all"
			>
				All
			</button>
			{allTypes.map((type) => (
				<button
					class="filter-btn px-4 py-2 rounded-full border border-gray-300 text-sm font-medium hover:bg-indigo-50 hover:text-indigo-800 bg-white text-gray-700 focus:outline-none ring-offset-2 focus:ring-2 focus:ring-indigo-500 capitalize"
					data-filter={type}
				>
					{type}
				</button>
			))}
		</div>
	</div>

	<div class="space-y-6" id="publications-list">
		{publications.map((pub) => (
			<div
				class="publication-item bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 border-l-4 border-indigo-500"
				data-type={pub.data.type}
			>
				<div class="flex flex-col md:flex-row md:justify-between md:items-start">
					<div>
						<h3 class="text-xl font-bold text-gray-900 mb-2">
							{pub.data.link ? (
								<a href={pub.data.link} target="_blank" rel="noopener noreferrer" class="hover:text-indigo-600 transition-colors">
									{pub.data.title}
								</a>
							) : (
								pub.data.title
							)}
						</h3>
						<p class="text-gray-700 mb-1">{pub.data.authors.join(', ')}</p>
						<p class="text-gray-500 text-sm mb-2 italic">
							{pub.data.conference || pub.data.journal} ({pub.data.year})
						</p>
						<span class="inline-block px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs font-semibold capitalize">
							{pub.data.type}
						</span>
					</div>
				</div>
			</div>
		))}
	</div>
</Layout>

<script>
	const buttons = document.querySelectorAll('.filter-btn');
	const items = document.querySelectorAll('.publication-item');

	buttons.forEach(btn => {
		btn.addEventListener('click', () => {
			// Update active state
			buttons.forEach(b => {
				b.classList.remove('bg-indigo-100', 'text-indigo-800');
				b.classList.add('bg-white', 'text-gray-700');
			});
			btn.classList.remove('bg-white', 'text-gray-700');
			btn.classList.add('bg-indigo-100', 'text-indigo-800');

			const filter = btn.getAttribute('data-filter') || 'all';

			items.forEach(item => {
				const type = item.getAttribute('data-type');
				if (filter === 'all' || type === filter) {
					(item as HTMLElement).style.display = 'block';
				} else {
					(item as HTMLElement).style.display = 'none';
				}
			});
		});
	});
</script>
