---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import PublicationItem from '../components/PublicationItem.astro';
import FilterButton from '../components/FilterButton.astro';

const publications = await getCollection('publications');
// Sort by year descending
publications.sort((a, b) => b.data.year - a.data.year);

const allTypes = [...new Set(publications.map(p => p.data.type))];
---

<Layout title="Publications | My Portfolio">
	<h1 class="text-3xl font-bold mb-8">Publications</h1>

	<section class="mb-8" aria-label="Publication Filters">
		<h2 class="text-xl font-semibold mb-3 text-gray-700">Filter by Type:</h2>
		<div class="flex flex-wrap gap-2" id="filters">
			<FilterButton filter="all" label="All" isActive={true} />
			{allTypes.map((type) => (
				<FilterButton filter={type} label={type} />
			))}
		</div>
	</section>

	<section class="space-y-6" id="publications-list" aria-label="Publications List">
		{publications.map((pub) => (
			<div class="publication-item-wrapper" data-type={pub.data.type}>
				<PublicationItem
					title={pub.data.title}
					authors={pub.data.authors}
					venue={pub.data.conference || pub.data.journal}
					year={pub.data.year}
					type={pub.data.type}
					link={pub.data.link}
				/>
			</div>
		))}
	</section>
</Layout>

<script>
	const buttons = document.querySelectorAll('.filter-btn');
	const items = document.querySelectorAll('.publication-item-wrapper');

	buttons.forEach(btn => {
		btn.addEventListener('click', () => {
			// Update active state
			buttons.forEach(b => {
				b.classList.remove('bg-indigo-100', 'text-indigo-800');
				b.classList.add('bg-white', 'text-gray-700', 'hover:bg-indigo-50', 'hover:text-indigo-800');
				b.setAttribute('aria-pressed', 'false');
			});
			btn.classList.remove('bg-white', 'text-gray-700', 'hover:bg-indigo-50', 'hover:text-indigo-800');
			btn.classList.add('bg-indigo-100', 'text-indigo-800');
			btn.setAttribute('aria-pressed', 'true');

			const filter = btn.getAttribute('data-filter') || 'all';

			items.forEach(item => {
				const type = item.getAttribute('data-type');
				if (filter === 'all' || type === filter) {
					(item as HTMLElement).style.display = 'block';
				} else {
					(item as HTMLElement).style.display = 'none';
				}
			});
		});
	});
</script>
